<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Data Analysis in Social Science 3</title>
  <meta name="description" content="A website for the Data Analysis in Social Science 3 module.">
  <meta name="generator" content="bookdown 0.6 and GitBook 2.6.7">

  <meta property="og:title" content="Data Analysis in Social Science 3" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://abessudnov.net/dataanalysis3/" />
  
  <meta property="og:description" content="A website for the Data Analysis in Social Science 3 module." />
  <meta name="github-repo" content="abessudnov/dataanalysis3" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Data Analysis in Social Science 3" />
  
  <meta name="twitter:description" content="A website for the Data Analysis in Social Science 3 module." />
  

<meta name="author" content="Alexey Bessudnov &amp; Max Shilling">


<meta name="date" content="2018-06-06">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="joining.html">
<link rel="next" href="tidy-data.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-113869422-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-113869422-1');
</script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#things-to-do-before-the-next-class"><i class="fa fa-check"></i><b>1.1</b> Things to do before the next class</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="module-outline.html"><a href="module-outline.html"><i class="fa fa-check"></i><b>2</b> Module outline</a><ul>
<li class="chapter" data-level="2.1" data-path="module-outline.html"><a href="module-outline.html#practical-arrangements"><i class="fa fa-check"></i><b>2.1</b> Practical arrangements</a></li>
<li class="chapter" data-level="2.2" data-path="module-outline.html"><a href="module-outline.html#aims-of-the-module"><i class="fa fa-check"></i><b>2.2</b> Aims of the module</a></li>
<li class="chapter" data-level="2.3" data-path="module-outline.html"><a href="module-outline.html#attendance"><i class="fa fa-check"></i><b>2.3</b> Attendance</a></li>
<li class="chapter" data-level="2.4" data-path="module-outline.html"><a href="module-outline.html#assessment"><i class="fa fa-check"></i><b>2.4</b> Assessment</a></li>
<li class="chapter" data-level="2.5" data-path="module-outline.html"><a href="module-outline.html#syllabus-plan"><i class="fa fa-check"></i><b>2.5</b> Syllabus plan</a></li>
<li class="chapter" data-level="2.6" data-path="module-outline.html"><a href="module-outline.html#reading-list"><i class="fa fa-check"></i><b>2.6</b> Reading list</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="assignment.html"><a href="assignment.html"><i class="fa fa-check"></i><b>3</b> Assignment</a></li>
<li class="chapter" data-level="4" data-path="readdata.html"><a href="readdata.html"><i class="fa fa-check"></i><b>4</b> Read data</a><ul>
<li class="chapter" data-level="4.1" data-path="readdata.html"><a href="readdata.html#introduction-to-reading-data"><i class="fa fa-check"></i><b>4.1</b> Introduction to Reading Data</a></li>
<li class="chapter" data-level="4.2" data-path="readdata.html"><a href="readdata.html#reading-common-data-files-into-r"><i class="fa fa-check"></i><b>4.2</b> Reading common data files into R</a><ul>
<li class="chapter" data-level="4.2.1" data-path="readdata.html"><a href="readdata.html#ways-to-read-data-into-r"><i class="fa fa-check"></i><b>4.2.1</b> Ways to read data into R</a></li>
<li class="chapter" data-level="4.2.2" data-path="readdata.html"><a href="readdata.html#comparing-these-three-methods"><i class="fa fa-check"></i><b>4.2.2</b> Comparing these three methods</a></li>
<li class="chapter" data-level="4.2.3" data-path="readdata.html"><a href="readdata.html#editing-a-dataset-while-reading-it-into-r"><i class="fa fa-check"></i><b>4.2.3</b> Editing a dataset while reading it into R</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="readdata.html"><a href="readdata.html#reading-other-data-files"><i class="fa fa-check"></i><b>4.3</b> Reading other data files</a><ul>
<li class="chapter" data-level="4.3.1" data-path="readdata.html"><a href="readdata.html#excel"><i class="fa fa-check"></i><b>4.3.1</b> Excel</a></li>
<li class="chapter" data-level="4.3.2" data-path="readdata.html"><a href="readdata.html#spss"><i class="fa fa-check"></i><b>4.3.2</b> SPSS</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="readdata.html"><a href="readdata.html#saving-datasets"><i class="fa fa-check"></i><b>4.4</b> Saving datasets</a><ul>
<li class="chapter" data-level="4.4.1" data-path="readdata.html"><a href="readdata.html#saving-data-as-a-text-file"><i class="fa fa-check"></i><b>4.4.1</b> Saving data as a text file</a></li>
<li class="chapter" data-level="4.4.2" data-path="readdata.html"><a href="readdata.html#saving-data-as-an-excel-file"><i class="fa fa-check"></i><b>4.4.2</b> Saving data as an Excel file</a></li>
<li class="chapter" data-level="4.4.3" data-path="readdata.html"><a href="readdata.html#saving-data-as-an-spss-file"><i class="fa fa-check"></i><b>4.4.3</b> Saving data as an SPSS file</a></li>
<li class="chapter" data-level="4.4.4" data-path="readdata.html"><a href="readdata.html#loading-these-datasets-back-into-r"><i class="fa fa-check"></i><b>4.4.4</b> Loading these datasets back into R</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="readdata.html"><a href="readdata.html#saving-the-working-environment"><i class="fa fa-check"></i><b>4.5</b> Saving the working environment</a></li>
<li class="chapter" data-level="4.6" data-path="readdata.html"><a href="readdata.html#reading-in-multiple-waves-from-understanding-society"><i class="fa fa-check"></i><b>4.6</b> Reading in multiple waves from Understanding Society</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="transformdata.html"><a href="transformdata.html"><i class="fa fa-check"></i><b>5</b> Transform data</a><ul>
<li class="chapter" data-level="5.1" data-path="transformdata.html"><a href="transformdata.html#the-pipe-operator"><i class="fa fa-check"></i><b>5.1</b> The pipe operator (%&gt;%)</a></li>
<li class="chapter" data-level="5.2" data-path="transformdata.html"><a href="transformdata.html#select-variables"><i class="fa fa-check"></i><b>5.2</b> Select variables</a></li>
<li class="chapter" data-level="5.3" data-path="transformdata.html"><a href="transformdata.html#select-cases"><i class="fa fa-check"></i><b>5.3</b> Select cases</a></li>
<li class="chapter" data-level="5.4" data-path="transformdata.html"><a href="transformdata.html#create-new-variables"><i class="fa fa-check"></i><b>5.4</b> Create new variables</a></li>
<li class="chapter" data-level="5.5" data-path="transformdata.html"><a href="transformdata.html#sort-data"><i class="fa fa-check"></i><b>5.5</b> Sort data</a></li>
<li class="chapter" data-level="5.6" data-path="transformdata.html"><a href="transformdata.html#summarise-data"><i class="fa fa-check"></i><b>5.6</b> Summarise data</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="joining.html"><a href="joining.html"><i class="fa fa-check"></i><b>6</b> Join data</a><ul>
<li class="chapter" data-level="6.1" data-path="joining.html"><a href="joining.html#introduction-to-joining-data"><i class="fa fa-check"></i><b>6.1</b> Introduction to joining data</a></li>
<li class="chapter" data-level="6.2" data-path="joining.html"><a href="joining.html#joining-waves-1-and-2"><i class="fa fa-check"></i><b>6.2</b> Joining waves 1 and 2</a><ul>
<li class="chapter" data-level="6.2.1" data-path="joining.html"><a href="joining.html#the-key"><i class="fa fa-check"></i><b>6.2.1</b> The ‘key’</a></li>
<li class="chapter" data-level="6.2.2" data-path="joining.html"><a href="joining.html#inner-join"><i class="fa fa-check"></i><b>6.2.2</b> Inner join</a></li>
<li class="chapter" data-level="6.2.3" data-path="joining.html"><a href="joining.html#left-join"><i class="fa fa-check"></i><b>6.2.3</b> Left join</a></li>
<li class="chapter" data-level="6.2.4" data-path="joining.html"><a href="joining.html#right-join"><i class="fa fa-check"></i><b>6.2.4</b> Right join</a></li>
<li class="chapter" data-level="6.2.5" data-path="joining.html"><a href="joining.html#full-join"><i class="fa fa-check"></i><b>6.2.5</b> Full join</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="iteration.html"><a href="iteration.html"><i class="fa fa-check"></i><b>7</b> Iteration</a></li>
<li class="chapter" data-level="8" data-path="tidy-data.html"><a href="tidy-data.html"><i class="fa fa-check"></i><b>8</b> Tidy data</a><ul>
<li class="chapter" data-level="8.1" data-path="tidy-data.html"><a href="tidy-data.html#long-and-wide-formats"><i class="fa fa-check"></i><b>8.1</b> Long and wide formats</a></li>
<li class="chapter" data-level="8.2" data-path="tidy-data.html"><a href="tidy-data.html#cleaning-the-data"><i class="fa fa-check"></i><b>8.2</b> Cleaning the data</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="datavis.html"><a href="datavis.html"><i class="fa fa-check"></i><b>9</b> Data visualisation</a><ul>
<li class="chapter" data-level="9.1" data-path="datavis.html"><a href="datavis.html#reading-in-the-data"><i class="fa fa-check"></i><b>9.1</b> Reading in the data</a></li>
<li class="chapter" data-level="9.2" data-path="datavis.html"><a href="datavis.html#visualising-one-quantitative-variable"><i class="fa fa-check"></i><b>9.2</b> Visualising one quantitative variable</a><ul>
<li class="chapter" data-level="9.2.1" data-path="datavis.html"><a href="datavis.html#histogram."><i class="fa fa-check"></i><b>9.2.1</b> Histogram.</a></li>
<li class="chapter" data-level="9.2.2" data-path="datavis.html"><a href="datavis.html#density-chart."><i class="fa fa-check"></i><b>9.2.2</b> Density chart.</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="datavis.html"><a href="datavis.html#visualising-one-categorical-variable"><i class="fa fa-check"></i><b>9.3</b> Visualising one categorical variable</a><ul>
<li class="chapter" data-level="9.3.1" data-path="datavis.html"><a href="datavis.html#bar-plot."><i class="fa fa-check"></i><b>9.3.1</b> Bar plot.</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="datavis.html"><a href="datavis.html#visualising-two-quantitative-variables"><i class="fa fa-check"></i><b>9.4</b> Visualising two quantitative variables</a></li>
<li class="chapter" data-level="9.5" data-path="datavis.html"><a href="datavis.html#visualising-one-categorical-and-one-quantitative-variable"><i class="fa fa-check"></i><b>9.5</b> Visualising one categorical and one quantitative variable</a></li>
<li class="chapter" data-level="9.6" data-path="datavis.html"><a href="datavis.html#visualising-two-categorical-variables"><i class="fa fa-check"></i><b>9.6</b> Visualising two categorical variables</a></li>
<li class="chapter" data-level="9.7" data-path="datavis.html"><a href="datavis.html#showing-the-relationships-by-group"><i class="fa fa-check"></i><b>9.7</b> Showing the relationships by group</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="datavis2.html"><a href="datavis2.html"><i class="fa fa-check"></i><b>10</b> Data visualisation 2</a><ul>
<li class="chapter" data-level="10.1" data-path="datavis2.html"><a href="datavis2.html#visualising-income"><i class="fa fa-check"></i><b>10.1</b> Visualising income</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="rmarkdown.html"><a href="rmarkdown.html"><i class="fa fa-check"></i><b>11</b> R Markdown</a></li>
<li class="chapter" data-level="12" data-path="modelling.html"><a href="modelling.html"><i class="fa fa-check"></i><b>12</b> Modelling</a><ul>
<li class="chapter" data-level="12.1" data-path="modelling.html"><a href="modelling.html#cross-sectional-analysis"><i class="fa fa-check"></i><b>12.1</b> Cross-sectional analysis</a><ul>
<li class="chapter" data-level="12.1.1" data-path="modelling.html"><a href="modelling.html#age-and-political-interest"><i class="fa fa-check"></i><b>12.1.1</b> Age and political interest</a></li>
<li class="chapter" data-level="12.1.2" data-path="modelling.html"><a href="modelling.html#sex-and-political-interest"><i class="fa fa-check"></i><b>12.1.2</b> Sex and political interest</a></li>
<li class="chapter" data-level="12.1.3" data-path="modelling.html"><a href="modelling.html#linear-model"><i class="fa fa-check"></i><b>12.1.3</b> Linear model</a></li>
<li class="chapter" data-level="12.1.4" data-path="modelling.html"><a href="modelling.html#interaction-effect-between-sex-and-age"><i class="fa fa-check"></i><b>12.1.4</b> Interaction effect between sex and age</a></li>
<li class="chapter" data-level="12.1.5" data-path="modelling.html"><a href="modelling.html#checking-the-assumptions"><i class="fa fa-check"></i><b>12.1.5</b> Checking the assumptions</a></li>
<li class="chapter" data-level="12.1.6" data-path="modelling.html"><a href="modelling.html#presenting-the-output-for-multiple-regression-models"><i class="fa fa-check"></i><b>12.1.6</b> Presenting the output for multiple regression models</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="modelling.html"><a href="modelling.html#longitudinal-analysis"><i class="fa fa-check"></i><b>12.2</b> Longitudinal analysis</a><ul>
<li class="chapter" data-level="12.2.1" data-path="modelling.html"><a href="modelling.html#simple-model"><i class="fa fa-check"></i><b>12.2.1</b> Simple model</a></li>
<li class="chapter" data-level="12.2.2" data-path="modelling.html"><a href="modelling.html#adding-a-time-constant-variable"><i class="fa fa-check"></i><b>12.2.2</b> Adding a time-constant variable</a></li>
<li class="chapter" data-level="12.2.3" data-path="modelling.html"><a href="modelling.html#adding-a-time-varying-variable"><i class="fa fa-check"></i><b>12.2.3</b> Adding a time-varying variable</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="modelling.html"><a href="modelling.html#further-reading"><i class="fa fa-check"></i><b>12.3</b> Further reading</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Analysis in Social Science 3</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="iteration" class="section level1">
<h1><span class="header-section-number">7</span> Iteration</h1>
<blockquote>
<p>Please read ch.21 (Iteration) from R for Data Science - <a href="http://r4ds.had.co.nz/iteration.html" class="uri">http://r4ds.had.co.nz/iteration.html</a></p>
</blockquote>
<p>In the Understanding Society data we have seven waves and seven separate individual files for adult questionnaires. We will need to read them all for the data to be joined. Of course, we can read them one by one, but this is inconvenient.</p>
<p>We will use this example to learn about iteration, one of the most important concepts in programming. You should read ch.21 from R for Data Science and do the exercises to learn the basics; here we will consider how we can apply iteration to our case.</p>
<p>Let us first consider a very simple <strong>for</strong> loop.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>) {
  <span class="kw">print</span>(i)
}</code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 3
## [1] 4
## [1] 5</code></pre>
<p>This loop goes through the values from 1 to 5 and in each iteration it prints the number on the screen. With the Understanding Society data, we want to go from 1 to 7 (as we have seven waves) and in each iteration we want to read in the data and join it to the data from other waves. Let us see how we can write a loop that does it.</p>
<p>First, we need to identify the files we want to open. The <strong>dir</strong> function will return the paths and names of all the data files in our data folder that contain the pattern <em>indresp</em>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">files &lt;-<span class="st"> </span><span class="kw">dir</span>(<span class="st">&quot;data/UKDA-6614-tab/tab&quot;</span>,
             <span class="dt">pattern=</span><span class="st">&quot;indresp&quot;</span>, <span class="dt">recursive =</span> <span class="ot">TRUE</span>, <span class="dt">full.names=</span><span class="ot">TRUE</span>)
files</code></pre></div>
<pre><code>##  [1] &quot;data/UKDA-6614-tab/tab/bhps_w1/ba_indresp.tab&quot; 
##  [2] &quot;data/UKDA-6614-tab/tab/bhps_w10/bj_indresp.tab&quot;
##  [3] &quot;data/UKDA-6614-tab/tab/bhps_w11/bk_indresp.tab&quot;
##  [4] &quot;data/UKDA-6614-tab/tab/bhps_w12/bl_indresp.tab&quot;
##  [5] &quot;data/UKDA-6614-tab/tab/bhps_w13/bm_indresp.tab&quot;
##  [6] &quot;data/UKDA-6614-tab/tab/bhps_w14/bn_indresp.tab&quot;
##  [7] &quot;data/UKDA-6614-tab/tab/bhps_w15/bo_indresp.tab&quot;
##  [8] &quot;data/UKDA-6614-tab/tab/bhps_w16/bp_indresp.tab&quot;
##  [9] &quot;data/UKDA-6614-tab/tab/bhps_w17/bq_indresp.tab&quot;
## [10] &quot;data/UKDA-6614-tab/tab/bhps_w18/br_indresp.tab&quot;
## [11] &quot;data/UKDA-6614-tab/tab/bhps_w2/bb_indresp.tab&quot; 
## [12] &quot;data/UKDA-6614-tab/tab/bhps_w3/bc_indresp.tab&quot; 
## [13] &quot;data/UKDA-6614-tab/tab/bhps_w4/bd_indresp.tab&quot; 
## [14] &quot;data/UKDA-6614-tab/tab/bhps_w5/be_indresp.tab&quot; 
## [15] &quot;data/UKDA-6614-tab/tab/bhps_w6/bf_indresp.tab&quot; 
## [16] &quot;data/UKDA-6614-tab/tab/bhps_w7/bg_indresp.tab&quot; 
## [17] &quot;data/UKDA-6614-tab/tab/bhps_w8/bh_indresp.tab&quot; 
## [18] &quot;data/UKDA-6614-tab/tab/bhps_w9/bi_indresp.tab&quot; 
## [19] &quot;data/UKDA-6614-tab/tab/us_w1/a_indresp.tab&quot;    
## [20] &quot;data/UKDA-6614-tab/tab/us_w2/b_indresp.tab&quot;    
## [21] &quot;data/UKDA-6614-tab/tab/us_w3/c_indresp.tab&quot;    
## [22] &quot;data/UKDA-6614-tab/tab/us_w4/d_indresp.tab&quot;    
## [23] &quot;data/UKDA-6614-tab/tab/us_w5/e_indresp.tab&quot;    
## [24] &quot;data/UKDA-6614-tab/tab/us_w6/f_indresp.tab&quot;    
## [25] &quot;data/UKDA-6614-tab/tab/us_w7/g_indresp.tab&quot;</code></pre>
<p>There are 25 files as we also have data from the BHPS, not just the Understanding Society. We do not need the BHPS, so we want to select only the files from the Understanding Society. We can use the function <strong>str_detect</strong> from the package <strong>stringr</strong> to select only the files whose paths contain <em>us</em>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># stringr will return a logical vector. Note that I specify which package the function comes from</span>
<span class="co"># without explicitly attaching it.</span>
stringr<span class="op">::</span><span class="kw">str_detect</span>(files, <span class="st">&quot;us&quot;</span>)</code></pre></div>
<pre><code>##  [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [12] FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE
## [23]  TRUE  TRUE  TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Now I only select the files from UndSoc</span>
files &lt;-<span class="st"> </span>files[stringr<span class="op">::</span><span class="kw">str_detect</span>(files, <span class="st">&quot;us&quot;</span>)]
files</code></pre></div>
<pre><code>## [1] &quot;data/UKDA-6614-tab/tab/us_w1/a_indresp.tab&quot;
## [2] &quot;data/UKDA-6614-tab/tab/us_w2/b_indresp.tab&quot;
## [3] &quot;data/UKDA-6614-tab/tab/us_w3/c_indresp.tab&quot;
## [4] &quot;data/UKDA-6614-tab/tab/us_w4/d_indresp.tab&quot;
## [5] &quot;data/UKDA-6614-tab/tab/us_w5/e_indresp.tab&quot;
## [6] &quot;data/UKDA-6614-tab/tab/us_w6/f_indresp.tab&quot;
## [7] &quot;data/UKDA-6614-tab/tab/us_w7/g_indresp.tab&quot;</code></pre>
<p>Now we have a vector of file names we want to loop over. We can write a short loop that prints the path and files name.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) {
  <span class="kw">print</span>(files[i])
}</code></pre></div>
<pre><code>## [1] &quot;data/UKDA-6614-tab/tab/us_w1/a_indresp.tab&quot;
## [1] &quot;data/UKDA-6614-tab/tab/us_w2/b_indresp.tab&quot;
## [1] &quot;data/UKDA-6614-tab/tab/us_w3/c_indresp.tab&quot;
## [1] &quot;data/UKDA-6614-tab/tab/us_w4/d_indresp.tab&quot;
## [1] &quot;data/UKDA-6614-tab/tab/us_w5/e_indresp.tab&quot;
## [1] &quot;data/UKDA-6614-tab/tab/us_w6/f_indresp.tab&quot;
## [1] &quot;data/UKDA-6614-tab/tab/us_w7/g_indresp.tab&quot;</code></pre>
<p>Note that the same task can be achieved simply with:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span> (i <span class="cf">in</span> files) {
  <span class="kw">print</span>(i)
}</code></pre></div>
<pre><code>## [1] &quot;data/UKDA-6614-tab/tab/us_w1/a_indresp.tab&quot;
## [1] &quot;data/UKDA-6614-tab/tab/us_w2/b_indresp.tab&quot;
## [1] &quot;data/UKDA-6614-tab/tab/us_w3/c_indresp.tab&quot;
## [1] &quot;data/UKDA-6614-tab/tab/us_w4/d_indresp.tab&quot;
## [1] &quot;data/UKDA-6614-tab/tab/us_w5/e_indresp.tab&quot;
## [1] &quot;data/UKDA-6614-tab/tab/us_w6/f_indresp.tab&quot;
## [1] &quot;data/UKDA-6614-tab/tab/us_w7/g_indresp.tab&quot;</code></pre>
<p>You will see a bit later why I wanted to loop over numbers rather than elements of the character vector.</p>
<p>Now we need to read in the data. We can read the whole files, but this is inefficient as we will only need a few variables. The function <strong>fread</strong> from the package <strong>data.table</strong> allows us to specify the variables we want to read. Let us choose the id variable (<strong>pidp</strong>), sex, age, interest in politics and net monthly income. The problem is that in each wave these variables have different names indicated by a prefix. <strong>pidp</strong> does not change and has the same name in each wave. All the other variables have a prefix <strong>a_</strong> in wave 1, <strong>b_</strong> in wave 2, etc. We will need to find a way to loop over not just file names in <strong>files</strong>, but also prefixes at the same time.</p>
<p>Let us start with creating a vector of the variable names without the prefixes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;dvage&quot;</span>, <span class="st">&quot;vote6&quot;</span>, <span class="st">&quot;fimnnet_dv&quot;</span>)</code></pre></div>
<p>If we want to add a prefix to the elements of this vector we can use the function <strong>paste</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">paste</span>(<span class="st">&quot;a&quot;</span>, vars, <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;a_sex&quot;        &quot;a_dvage&quot;      &quot;a_vote6&quot;      &quot;a_fimnnet_dv&quot;</code></pre>
<p>The constant <strong>letters</strong> contains all the letters of the English alphabet, so the same expression can be written as the following.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">paste</span>(letters[<span class="dv">1</span>], vars, <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;a_sex&quot;        &quot;a_dvage&quot;      &quot;a_vote6&quot;      &quot;a_fimnnet_dv&quot;</code></pre>
<p>Now we can write a loop that goes through the values 1 to 7 and in each iteration reads the correct data file choosing the variables with the correct prefix.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Attach data.table</span>
<span class="kw">library</span>(data.table)
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) {
        <span class="co"># Create a vector of the variables with the correct prefix.</span>
        varsToSelect &lt;-<span class="st"> </span><span class="kw">paste</span>(letters[i], vars, <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>)
        <span class="co"># Add pidp to this vector (no prefix for pidp)</span>
        varsToSelect &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;pidp&quot;</span>, varsToSelect)
        <span class="co"># Now read the data. </span>
        data &lt;-<span class="st"> </span><span class="kw">fread</span>(files[i], <span class="dt">select =</span> varsToSelect)
        <span class="co"># print the first line</span>
        <span class="kw">print</span>(<span class="kw">head</span>(data, <span class="dv">1</span>))
}        </code></pre></div>
<pre><code>##        pidp a_sex a_dvage a_vote6 a_fimnnet_dv
## 1: 68001367     1      39       3         1400
##        pidp b_sex b_dvage b_vote6 b_fimnnet_dv
## 1: 68004087     1      60       2     1276.667
## 
Read 0.0% of 49739 rows
Read 80.4% of 49739 rows
Read 49739 rows and 5 (of 3024) columns from 0.402 GB file in 00:00:07
##        pidp c_sex c_dvage c_vote6 c_fimnnet_dv
## 1: 68004087     1      61       2     914.3333
## 
Read 0.0% of 47157 rows
Read 47157 rows and 5 (of 2086) columns from 0.262 GB file in 00:00:05
##        pidp d_sex d_dvage d_vote6 d_fimnnet_dv
## 1: 68004087     1      62       1     914.3333
## 
Read 0.0% of 44903 rows
Read 44903 rows and 5 (of 2583) columns from 0.310 GB file in 00:00:05
##        pidp e_sex e_dvage e_vote6 e_fimnnet_dv
## 1: 68004087     1      63       2     1015.667
## 
Read 0.0% of 45290 rows
Read 45290 rows and 5 (of 2060) columns from 0.263 GB file in 00:00:04
##        pidp f_sex f_dvage f_vote6 f_fimnnet_dv
## 1: 68004087     1      64       2       1007.5
## 
Read 0.0% of 42217 rows
Read 42217 rows and 5 (of 2799) columns from 0.321 GB file in 00:00:08
##        pidp g_sex g_dvage g_vote6 g_fimnnet_dv
## 1: 68004087     1      65       2     1258.333</code></pre>
<p>Now we need to join all these data frames together, and we want to do this in the loop. It is clear what we need to do in the second and later iterations of the loop: join the data from wave 2 with the data from wave 1, etc. But what shall we do in the first iteration? There is no data frame yet to be joined with the data from wave 1. Clearly our algorithm for the first iteration needs to be different from the algorithm for all other iterations. We will use the <strong>if … else</strong> control structure for this.</p>
<p>In the first iteration of the loop we simply want to save the data from wave 1. In the second and other iterations we want the data to be joined with the data frame we have from the previous iteration.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) {
        <span class="co"># Create a vector of the variables with the correct prefix.</span>
        varsToSelect &lt;-<span class="st"> </span><span class="kw">paste</span>(letters[i], vars, <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>)
        <span class="co"># Add pidp to this vector (no prefix for pidp)</span>
        varsToSelect &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;pidp&quot;</span>, varsToSelect)
        <span class="co"># Now read the data. </span>
        data &lt;-<span class="st"> </span><span class="kw">fread</span>(files[i], <span class="dt">select =</span> varsToSelect)
        <span class="cf">if</span> (i <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) {
                all7 &lt;-<span class="st"> </span>data  
        }
        <span class="cf">else</span> {
                all7 &lt;-<span class="st"> </span><span class="kw">full_join</span>(all7, data, <span class="dt">by =</span> <span class="st">&quot;pidp&quot;</span>)
        }
        <span class="co"># Now we can remove data to free up memory</span>
        <span class="kw">rm</span>(data)
} </code></pre></div>
<p><strong>all7</strong> now contains the data from all seven waves.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(all7, <span class="dv">3</span>)</code></pre></div>
<pre><code>##       pidp a_sex a_dvage a_vote6 a_fimnnet_dv b_sex b_dvage b_vote6
## 1 68001367     1      39       3    1400.0000    NA      NA      NA
## 2 68004087     1      59       2     802.0833     1      60       2
## 3 68006127     2      39       4    1179.5267     2      40       4
##   b_fimnnet_dv c_sex c_dvage c_vote6 c_fimnnet_dv d_sex d_dvage d_vote6
## 1           NA    NA      NA      NA           NA    NA      NA      NA
## 2     1276.667     1      61       2     914.3333     1      62       1
## 3     1115.993     2      41       4    1175.6666     2      43       4
##   d_fimnnet_dv e_sex e_dvage e_vote6 e_fimnnet_dv f_sex f_dvage f_vote6
## 1           NA    NA      NA      NA           NA    NA      NA      NA
## 2     914.3333     1      63       2     1015.667     1      64       2
## 3     851.6666     2      43       4     1025.276     2      44       4
##   f_fimnnet_dv g_sex g_dvage g_vote6 g_fimnnet_dv
## 1           NA    NA      NA      NA           NA
## 2     1007.500     1      65       2     1258.333
## 3     1108.833     2      45       4      385.000</code></pre>
<p>I will now save this file for future use using the <strong>saveRDS</strong> function in the <em>myData</em> folder (make sure first you have this folder on your computer).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">saveRDS</span>(all7, <span class="st">&quot;myData/all7.rds&quot;</span>)</code></pre></div>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="joining.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="tidy-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
